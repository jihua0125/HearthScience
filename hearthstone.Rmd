---
title: "Hearth-science"
output: html_document
---

# Stage 1

The card a player can use is restricted by the number of mana he/she has for that turn, starting from 0 at the beginning and will reach to a maximum of 10 since the 10th turn. If there is no card with cost less than or equal to the number of mana in that turn, the player cannot use any card.
Note that without this consideration, we may choose all 30 cards to be with very high cost -- however, we are not able to use them in the first several turns. If the opponent do have small cards, we may be attacked to death before we could ever use any card.
Therefore, the balance between "small" cards and "big" cards is important. In this stage, we want to know that how many card we want for each cost value, in a total of 30 cards.

Assumptions:
1. Players will not use the card with cost 0 in the earlier several turns.
2. Cost can roughly represent the value of the card, thus we can maximum the cost of all 30 cards to maximum the value.
3. We focus on the first 5 turns.

First, create decks with all reasonable combinations of small cards (1-5) and others.

```{r}
decks <- expand.grid(n1=0:6, n2=0:6, n3=0:6, n4=0:6, n5=0:6)
decks <- decks %>% tbl_df %>% mutate(others = 30-n1-n2-n3-n4-n5)

```

Next, use similation to estimate the probability to use card in the first 1/2/3/4/5-turn for each deck. Estimations are made for offensive player, as the defensive player has higher possiblity to use cards (4 cards at the begining with a special 0 cost card that temporatily increases the mana by 1) for the first few turns.

```{r}
prob_usecard <- function(deck){
        card <- rep(c(1,2,3,4,5,10), deck)
                
        # offensive player
        temp <- t(replicate(1000,sample(card,30)))
        # assume choosing the 3 smallest cards for the starting hand
        sortcard <- t(apply(temp[,1:6],1,sort))
        temp[,1:6] <- sortcard
        sortcard2 <- t(apply(temp[,4:30],1,function(x){sample(x,27)}))
        temp[,4:30] <- sortcard2
        rm(sortcard)
        rm(sortcard2)
        
        # p1: can use card in the first turn
        p1 <- mean(apply(temp[,1:4],1,function(c){as.numeric(sum(c<2)>0)}))  
        # p2: can use card in the first 2 turns
        p2 <- mean(apply(temp[,1:5],1,function(c){as.numeric(sum(c<3)>0)}))  
        # p3: can use card in the first 3 turns
        p3 <- mean(apply(temp[,1:6],1,function(c){as.numeric(sum(c<4)>0)}))  
        # p4: can use card in the first 4 turns
        p4 <- mean(apply(temp[,1:7],1,function(c){as.numeric(sum(c<5)>0)}))  
        # p5: can use card in the first 5 turns
        p5 <- mean(apply(temp[,1:8],1,function(c){as.numeric(sum(c<6)>0)}))  
        
        c(p1, p2, p3, p4, p5)     
}

# get the probability of using card and combine
usecard <- t(apply(decks,1,prob_usecard))
colnames(usecard) <- c("p1","p2","p3","p4","p5")
decks <- cbind(decks,usecard) %>% 
        # add the total cost for each deck
        mutate(sum = n1+2*n2+3*n3+4*n4+5*n5+10*others) 
rm(usecard)

# save simulation results 
write.csv(decks,file="/Users/Yinnan/Desktop/2016/HearthScience/simulation.csv")

library(readr)
decks <- read_csv("/Users/Yinnan/Desktop/2016/HearthScience/simulation.csv") 
```

Explore the probability of using card in relation to the sum of the deck

```{r}
library(ggplot2)
library(dplyr)

decks %>% ggplot(aes(x=sum, y=p4)) + geom_point()
decks <- decks[,-1]
decks.constrain <- decks %>% tbl_df %>% filter(p4>0.95, p2>0.5, p3>0.9, others>10) %>%
        arrange(desc(sum)) 

decks.constrain %>% summarize(min2 = min(n1+n2), min3 = min(n1+n2+n3), min4 = min(n1+n2+n3+n4))
write.csv(decks.constrain,file="/Users/Yinnan/Desktop/2016/HearthScience/simulation_constrain.csv")

```


# Stage 2
For each deck, there are several "core" cards that can have the greatest effect when they are used together. We will usually put 2 cards for each component of core cards, and we want to get at least one for every component as early as possible.

First we list all possible decks with core cards and normal cards. Each set of core cards includes 2-5 different components.
```{r}
# 2 components core cards set, each with 2 cards
card <- c(1,1,2,2,rep(0,26))
tmp <- t(replicate(1000,sample(card,30)))
# sort the first 6 card, assume we will always keep the core card
sortcard <- t(apply(tmp[,1:6],1,function(x){sort(x,decreasing = T)}))
tmp[,1:6] <- sortcard
sortcard2 <- t(apply(tmp[,4:30],1,function(x){sample(x,27)}))
tmp[,4:30] <- sortcard2
rm(sortcard)
rm(sortcard2)

# the probability of having the complete set of core cards by n turns
# we want to know by which turn the probability is above 0.9, to determin how many "extra card" card we want to put in out dek
q15 <- mean(apply(tmp[,1:18],1,function(c){as.numeric(sum(c==1)>0 & sum(c==2)>0)}))  
q16 <- mean(apply(tmp[,1:19],1,function(c){as.numeric(sum(c==1)>0 & sum(c==2)>0)}))  
q17 <- mean(apply(tmp[,1:20],1,function(c){as.numeric(sum(c==1)>0 & sum(c==2)>0)}))  
q18 <- mean(apply(tmp[,1:21],1,function(c){as.numeric(sum(c==1)>0 & sum(c==2)>0)}))  
q19 <- mean(apply(tmp[,1:22],1,function(c){as.numeric(sum(c==1)>0 & sum(c==2)>0)}))  
q20 <- mean(apply(tmp[,1:23],1,function(c){as.numeric(sum(c==1)>0 & sum(c==2)>0)}))  
c2 <- c(q15,q16,q17,q18,q19,q20)
```

```{r}
# 3 components core cards set, each with 2 cards
card <- c(1,1,2,2,3,3,rep(0,24))
tmp <- t(replicate(1000,sample(card,30)))
# sort the first 6 card, assume we will always keep the core card
sortcard <- t(apply(tmp[,1:6],1,function(x){sort(x,decreasing = T)}))
tmp[,1:6] <- sortcard
sortcard2 <- t(apply(tmp[,4:30],1,function(x){sample(x,27)}))
tmp[,4:30] <- sortcard2
rm(sortcard)
rm(sortcard2)

# the probability of having the complete set of core cards by n turns
# we want to know by which turn the probability is above 0.9, to determin how many "extra card" card we want to put in out dek
q15 <- mean(apply(tmp[,1:18],1,function(c){as.numeric(sum(c==1)>0 & sum(c==2)>0 & sum(c==3)>0)}))  
q16 <- mean(apply(tmp[,1:19],1,function(c){as.numeric(sum(c==1)>0 & sum(c==2)>0 & sum(c==3)>0)}))  
q17 <- mean(apply(tmp[,1:20],1,function(c){as.numeric(sum(c==1)>0 & sum(c==2)>0 & sum(c==3)>0)}))  
q18 <- mean(apply(tmp[,1:21],1,function(c){as.numeric(sum(c==1)>0 & sum(c==2)>0 & sum(c==3)>0)}))  
q19 <- mean(apply(tmp[,1:22],1,function(c){as.numeric(sum(c==1)>0 & sum(c==2)>0 & sum(c==3)>0)}))  
q20 <- mean(apply(tmp[,1:23],1,function(c){as.numeric(sum(c==1)>0 & sum(c==2)>0 & sum(c==3)>0)}))  
q21 <- mean(apply(tmp[,1:24],1,function(c){as.numeric(sum(c==1)>0 & sum(c==2)>0 & sum(c==3)>0)}))  
c3 <- c(q15,q16,q17,q18,q19,q20,q21)
```

```{r}
# 4 components core cards set, each with 2 cards
card <- c(1,1,2,2,3,3,4,4,rep(0,22))
tmp <- t(replicate(1000,sample(card,30)))
# sort the first 6 card, assume we will always keep the core card
sortcard <- t(apply(tmp[,1:6],1,function(x){sort(x,decreasing = T)}))
tmp[,1:6] <- sortcard
sortcard2 <- t(apply(tmp[,4:30],1,function(x){sample(x,27)}))
tmp[,4:30] <- sortcard2
rm(sortcard)
rm(sortcard2)

# the probability of having the complete set of core cards by n turns
# we want to know by which turn the probability is above 0.9, to determin how many "extra card" card we want to put in out dek
q15 <- mean(apply(tmp[,1:18],1,function(c){as.numeric(sum(c==1)>0 & sum(c==2)>0 & sum(c==3)>0 & sum(c==4)>0)}))  
q16 <- mean(apply(tmp[,1:19],1,function(c){as.numeric(sum(c==1)>0 & sum(c==2)>0 & sum(c==3)>0 & sum(c==4)>0)}))  
q17 <- mean(apply(tmp[,1:20],1,function(c){as.numeric(sum(c==1)>0 & sum(c==2)>0 & sum(c==3)>0 & sum(c==4)>0)}))  
q18 <- mean(apply(tmp[,1:21],1,function(c){as.numeric(sum(c==1)>0 & sum(c==2)>0 & sum(c==3)>0 & sum(c==4)>0)}))  
q19 <- mean(apply(tmp[,1:22],1,function(c){as.numeric(sum(c==1)>0 & sum(c==2)>0 & sum(c==3)>0 & sum(c==4)>0)}))  
q20 <- mean(apply(tmp[,1:23],1,function(c){as.numeric(sum(c==1)>0 & sum(c==2)>0 & sum(c==3)>0 & sum(c==4)>0)}))  
q21 <- mean(apply(tmp[,1:24],1,function(c){as.numeric(sum(c==1)>0 & sum(c==2)>0 & sum(c==3)>0 & sum(c==4)>0)}))  
q22 <- mean(apply(tmp[,1:25],1,function(c){as.numeric(sum(c==1)>0 & sum(c==2)>0 & sum(c==3)>0 & sum(c==4)>0)}))  

c4 <- c(q15,q16,q17,q18,q19,q20,q21,q22)
```

```{r}
# 5 components core card set
card <- c(1,1,2,2,3,3,4,4,5,5,rep(0,20))
tmp <- t(replicate(1000,sample(card,30)))
# sort the first 6 card, assume we will always keep the core card
sortcard <- t(apply(tmp[,1:6],1,function(x){sort(x,decreasing = T)}))
tmp[,1:6] <- sortcard
sortcard2 <- t(apply(tmp[,4:30],1,function(x){sample(x,27)}))
tmp[,4:30] <- sortcard2
rm(sortcard)
rm(sortcard2)

# the probability of having the complete set of core cards by n turns
# we want to know by which turn the probability is above 0.9, to determin how many "extra card" card we want to put in out dek
q15 <- mean(apply(tmp[,1:18],1,function(c){as.numeric(sum(c==1)>0 & sum(c==2)>0 & sum(c==3)>0 & sum(c==4)>0 & sum(c==5)>0)}))  
q16 <- mean(apply(tmp[,1:19],1,function(c){as.numeric(sum(c==1)>0 & sum(c==2)>0 & sum(c==3)>0 & sum(c==4)>0 & sum(c==5)>0)}))  
q17 <- mean(apply(tmp[,1:20],1,function(c){as.numeric(sum(c==1)>0 & sum(c==2)>0 & sum(c==3)>0 & sum(c==4)>0 & sum(c==5)>0)}))  
q18 <- mean(apply(tmp[,1:21],1,function(c){as.numeric(sum(c==1)>0 & sum(c==2)>0 & sum(c==3)>0 & sum(c==4)>0 & sum(c==5)>0)}))  
q19 <- mean(apply(tmp[,1:22],1,function(c){as.numeric(sum(c==1)>0 & sum(c==2)>0 & sum(c==3)>0 & sum(c==4)>0 & sum(c==5)>0)}))  
q20 <- mean(apply(tmp[,1:23],1,function(c){as.numeric(sum(c==1)>0 & sum(c==2)>0 & sum(c==3)>0 & sum(c==4)>0 & sum(c==5)>0)}))  
q21 <- mean(apply(tmp[,1:24],1,function(c){as.numeric(sum(c==1)>0 & sum(c==2)>0 & sum(c==3)>0 & sum(c==4)>0 & sum(c==5)>0)}))  
q22 <- mean(apply(tmp[,1:25],1,function(c){as.numeric(sum(c==1)>0 & sum(c==2)>0 & sum(c==3)>0 & sum(c==4)>0 & sum(c==5)>0)}))  

c5 <- c(q15,q16,q17,q18,q19,q20,q21,q22)
```









